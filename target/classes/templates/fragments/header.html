<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <header th:fragment="header" class="main-header">
        <nav class="navbar">
            <div class="nav-brand">
                <a th:href="@{/dashboard}">
                    <span class="icon">üìö</span>
                    H·ªá th·ªëng qu·∫£n l√Ω th∆∞ vi·ªán
                </a>
            </div>
            
            <div class="nav-menu">
                <div sec:authorize="hasRole('ADMIN')" class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle">
                        <span class="icon">‚öôÔ∏è</span>
                        Qu·∫£n l√Ω
                    </a>
                    <div class="dropdown-menu">
                        <a th:href="@{/admin/books}" class="dropdown-item">
                            <span class="icon">üìö</span>
                            Qu·∫£n l√Ω s√°ch
                        </a>
                        <a th:href="@{/admin/authors}" class="dropdown-item">
                            <span class="icon">‚úçÔ∏è</span>
                            Qu·∫£n l√Ω t√°c gi·∫£
                        </a>
                        <a th:href="@{/admin/users}" class="dropdown-item">
                            <span class="icon">üë•</span>
                            Qu·∫£n l√Ω ng∆∞·ªùi d√πng
                        </a>
                        <a th:href="@{/admin/borrows}" class="dropdown-item">
                            <span class="icon">üìã</span>
                            Qu·∫£n l√Ω m∆∞·ª£n tr·∫£
                        </a>
                        <a th:href="@{/admin/extension-requests}" class="dropdown-item">
                            <span class="icon">‚è∞</span>
                            Y√™u c·∫ßu gia h·∫°n
                        </a>
                        <a th:href="@{/admin/bookshelves}" class="dropdown-item">
                            <span class="icon">üóÑÔ∏è</span>
                            Qu·∫£n l√Ω t·ªß s√°ch
                        </a>
                    </div>
                </div>
                
                <div class="nav-item">
                    <a th:href="@{/books}" class="nav-link">
                        <span class="icon">üîç</span>
                        T√¨m s√°ch
                    </a>
                </div>
                
                <div sec:authorize="hasRole('USER')" class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle">
                        <span class="icon">üë§</span>
                        C√° nh√¢n
                    </a>
                    <div class="dropdown-menu">
                        <a th:href="@{/user/borrow}" class="dropdown-item">
                            <span class="icon">üìñ</span>
                            L·ªãch s·ª≠ m∆∞·ª£n
                        </a>
                        <a th:href="@{/user/extensions}" class="dropdown-item">
                            <span class="icon">‚è∞</span>
                            Y√™u c·∫ßu gia h·∫°n
                        </a>
                        <a th:href="@{/user/profile}" class="dropdown-item">
                            <span class="icon">‚öôÔ∏è</span>
                            Th√¥ng tin c√° nh√¢n
                        </a>
                    </div>
                </div>
                
                <div class="nav-item">
                    <a th:href="@{/logout}" class="nav-link">
                        <span class="icon">üö™</span>
                        ƒêƒÉng xu·∫•t
                    </a>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Session timeout warning -->
    <div id="sessionWarning" class="session-warning">
        <p><strong>C·∫£nh b√°o:</strong> Phi√™n c·ªßa b·∫°n s·∫Ω k·∫øt th√∫c sau 5 ph√∫t n·ªØa.</p>
        <button onclick="extendSession()" class="btn btn-sm" style="margin-top: 0.5rem;">Gia h·∫°n phi√™n</button>
    </div>
    
    <script>
        // Session timeout management
        let sessionTimeout;
        let warningTimeout;
        
        function resetSessionTimer() {
            clearTimeout(sessionTimeout);
            clearTimeout(warningTimeout);
            
            // Show warning after 10 minutes (600000ms)
            warningTimeout = setTimeout(showSessionWarning, 600000);
            
            // Logout after 15 minutes (900000ms)
            sessionTimeout = setTimeout(logoutUser, 900000);
        }
        
        function showSessionWarning() {
            document.getElementById('sessionWarning').classList.add('show');
        }
        
        function hideSessionWarning() {
            document.getElementById('sessionWarning').classList.remove('show');
        }
        
        function extendSession() {
            // Make a request to extend session
            fetch('/api/extend-session', { method: 'POST' })
                .then(() => {
                    hideSessionWarning();
                    resetSessionTimer();
                })
                .catch(() => {
                    console.error('Failed to extend session');
                });
        }
        
        function logoutUser() {
            window.location.href = '/logout';
        }
        
        // Reset timer on user activity
        document.addEventListener('click', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);
        document.addEventListener('scroll', resetSessionTimer);
        
        // Initialize timer
        resetSessionTimer();
    </script>
</body>
</html>
